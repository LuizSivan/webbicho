<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
		xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.29.xsd"
		objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
	<!-- Creating Users Table -->
	<changeSet id="1739586004736-1"
						 author="Luiz Silva">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="users"/>
			</not>
		</preConditions>
		
		<createTable tableName="users">
			<column name="uuid"
							type="UUID">
				<constraints nullable="false"
										 primaryKey="true"
										 primaryKeyName="pk_users"/>
			</column>
			<column name="created_by"
							type="UUID">
				<constraints nullable="false"/>
			</column>
			<column name="updated_by"
							type="UUID"/>
			<column name="created_at"
							type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column name="updated_at"
							type="DATETIME"/>
			<column name="deleted_at"
							type="DATETIME"/>
			<column name="username"
							type="VARCHAR(30)">
				<constraints nullable="false"/>
			</column>
			<column name="exibition_name"
							type="VARCHAR(255)">
				<constraints nullable="false"/>
			</column>
			<column name="email"
							type="VARCHAR(320)">
				<constraints nullable="false"/>
			</column>
			<column name="about"
							type="TEXT"/>
			<column name="role"
							type="VARCHAR(255)">
				<constraints nullable="false"/>
			</column>
			<column name="avatar"
							type="TEXT"/>
		</createTable>
		
		<addUniqueConstraint columnNames="username"
												 constraintName="uc_users_username"
												 tableName="users"/>
		<addUniqueConstraint columnNames="email"
												 constraintName="uc_users_email"
												 tableName="users"/>
		
		<addForeignKeyConstraint baseTableName="users"
														 baseColumnNames="created_by"
														 constraintName="fk_users_created_by"
														 referencedTableName="users"
														 referencedColumnNames="uuid"/>
		<addForeignKeyConstraint baseTableName="users"
														 baseColumnNames="updated_by"
														 constraintName="fk_users_updated_by"
														 referencedTableName="users"
														 referencedColumnNames="uuid"/>
		
		<createIndex indexName="idx_user"
								 tableName="users">
			<column name="username"/>
			<column name="email"/>
			<column name="role"/>
		</createIndex>
	</changeSet>
	
	<!-- Creating Posts Table -->
	<changeSet id="1739586004736-2"
						 author="Luiz Silva">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="posts"/>
			</not>
		</preConditions>
		
		<createTable tableName="posts">
			<column name="uuid"
							type="UUID">
				<constraints nullable="false"
										 primaryKey="true"
										 primaryKeyName="pk_posts"/>
			</column>
			<column name="created_by"
							type="UUID">
				<constraints nullable="false"/>
			</column>
			<column name="updated_by"
							type="UUID"/>
			<column name="created_at"
							type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column name="updated_at"
							type="DATETIME"/>
			<column name="deleted_at"
							type="DATETIME"/>
			<column name="content"
							type="TEXT">
				<constraints nullable="false"/>
			</column>
			<column name="file"
							type="TEXT"/>
			<column name="user_uuid"
							type="UUID">
				<constraints nullable="false"/>
			</column>
		</createTable>
		
		<addForeignKeyConstraint baseColumnNames="user_uuid"
														 baseTableName="posts"
														 constraintName="FK_POSTS_ON_USER_UUID"
														 referencedColumnNames="uuid"
														 referencedTableName="users"/>
		
		<addForeignKeyConstraint baseTableName="posts"
														 baseColumnNames="created_by"
														 constraintName="fk_posts_created_by"
														 referencedTableName="users"
														 referencedColumnNames="uuid"/>
		<addForeignKeyConstraint baseTableName="posts"
														 baseColumnNames="updated_by"
														 constraintName="fk_posts_updated_by"
														 referencedTableName="users"
														 referencedColumnNames="uuid"/>
	</changeSet>
	
	<!-- Creating Comments Table -->
	<changeSet id="1739586004736-3"
						 author="Luiz Silva">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="comments"/>
			</not>
		</preConditions>
		
		<createTable tableName="comments">
			<column name="uuid"
							type="UUID">
				<constraints nullable="false"
										 primaryKey="true"
										 primaryKeyName="pk_comments"/>
			</column>
			<column name="created_by"
							type="UUID">
				<constraints nullable="false"/>
			</column>
			<column name="updated_by"
							type="UUID"/>
			<column name="created_at"
							type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column name="updated_at"
							type="DATETIME"/>
			<column name="deleted_at"
							type="DATETIME"/>
			<column name="content"
							type="TEXT">
				<constraints nullable="false"/>
			</column>
			<column name="user_uuid"
							type="UUID">
				<constraints nullable="false"/>
			</column>
			<column name="post_uuid"
							type="UUID">
				<constraints nullable="false"/>
			</column>
		</createTable>
		
		<addForeignKeyConstraint baseColumnNames="user_uuid"
														 baseTableName="comments"
														 constraintName="FK_COMMENTS_ON_USER_UUID"
														 referencedColumnNames="uuid"
														 referencedTableName="users"/>
		<addForeignKeyConstraint baseColumnNames="post_uuid"
														 baseTableName="comments"
														 constraintName="FK_COMMENTS_ON_POST_UUID"
														 referencedColumnNames="uuid"
														 referencedTableName="posts"/>
		
		<addForeignKeyConstraint baseTableName="comments"
														 baseColumnNames="created_by"
														 constraintName="fk_comments_created_by"
														 referencedTableName="users"
														 referencedColumnNames="uuid"/>
		<addForeignKeyConstraint baseTableName="comments"
														 baseColumnNames="updated_by"
														 constraintName="fk_comments_updated_by"
														 referencedTableName="users"
														 referencedColumnNames="uuid"/>
	</changeSet>
</databaseChangeLog>
